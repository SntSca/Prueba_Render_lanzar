<!-- pagina-inicial-admin.html -->
<div class="full-screen-wrapper">
  <div class="page-wrapper">

    <nav class="navbar">
      <ul class="navbar-options">
        <li><a class="active">ğŸ‘¥ GestiÃ³n de Usuarios</a></li>
      </ul>

      <div class="user-panel">
        <div class="user-photo">
          <img
            *ngIf="userAvatarUrl; else initialsTpl"
            [src]="userAvatarUrl"
            alt="avatar"
            class="user-photo-img"
            (error)="onAvatarError()"
          />
          <ng-template #initialsTpl>
            <span class="user-photo-fallback">{{ userInitials }}</span>
          </ng-template>
        </div>
        <div class="user-info">
          <div class="user-name">{{ userName }}</div>
          <div class="user-email">{{ userEmail }}</div>
          <div class="user-role">ğŸ›¡ï¸ {{ userRole }}</div>
        </div>
        <button class="logout-btn" disabled>ğŸšª Salir</button>
      </div>
    </nav>

    <div class="main-container">
      <aside class="filter-panel">
        <h3>ğŸ” Filtros</h3>
        <form (submit)="$event.preventDefault()">
          <div class="filter-section">
            <label for="nombre">ğŸ”¤ BÃºsqueda (alias/nombre/apellidos/email)</label>
            <input
              id="nombre"
              type="text"
              name="nombre"
              [(ngModel)]="filtros.nombre"
              (ngModelChange)="onSearchChange()"
              placeholder="Buscar..."
            />
          </div>

          <div class="filter-section">
            <label for="tipo">ğŸ§© Tipo de usuario</label>
            <select
              id="tipo"
              name="tipo"
              [(ngModel)]="filtros.tipo"
              (ngModelChange)="onTipoChange()"
            >
              <option value="">Todos</option>
              <option value="ADMINISTRADOR">Administradores</option>
              <option value="GESTOR_CONTENIDO">Creadores</option>
              <option value="USUARIO">Usuarios</option>
            </select>
          </div>

          <div class="filter-section">
            <label for="bloqueado">ğŸ” Estado</label>
            <select
              id="bloqueado"
              name="bloqueado"
              [(ngModel)]="filtros.bloqueado"
              (ngModelChange)="onStateChange()"
            >
              <option value="">Todos</option>
              <option value="no">Activos</option>
              <option value="si">Bloqueados</option>
            </select>
          </div>

          <div class="filter-section">
            <label for="vip">â­ VIP</label>
            <select
              id="vip"
              name="vip"
              [(ngModel)]="filtros.vip"
              (ngModelChange)="onVipChange()"
            >
              <option value="">Cualquiera</option>
              <option value="si">SÃ­</option>
              <option value="no">No</option>
            </select>
          </div>

          <div class="filter-section">
            <label for="ordenar">â†•ï¸ Ordenar</label>
            <select
              id="ordenar"
              name="ordenar"
              [(ngModel)]="filtros.ordenar"
              (ngModelChange)="onOrderChange()"
            >
              <option value="fecha">ğŸ—“ï¸ Fecha</option>
              <option value="nombre">ğŸ”  Nombre</option>
              <option value="rol">ğŸ·ï¸ Rol</option>
              <option value="vip">â­ VIP</option>
            </select>
          </div>
        </form>
      </aside>

      <main class="content-area">
        <section>
          <h3>ğŸ¬ Creadores de contenido</h3>
          <button type="button" class="action-btn btn-edit" (click)="openCreate()">â• Nuevo creador</button>
          <button type="button" class="action-btn btn-edit" (click)="openCreateAdmin()">â• Nuevo administrador</button>

          <div class="spinner" *ngIf="loading">
            <div class="loader"></div><span>â³ Cargando...</span>
          </div>

          <div class="alert error" *ngIf="!loading && errorMsg">
            âŒ {{ errorMsg }}
          </div>

          <div class="empty" *ngIf="!loading && !errorMsg && filteredUsers.length === 0">
            ğŸ•µï¸â€â™‚ï¸ No hay resultados para los filtros actuales.
          </div>

          <div class="table-wrap" *ngIf="!loading && !errorMsg && filteredUsers.length > 0">
            <table class="users-table">
              <thead>
                <tr>
                  <th>ğŸ§‘ Alias</th>
                  <th>ğŸ“ Nombre</th>
                  <th>ğŸ“§ Email</th>
                  <th>ğŸ·ï¸ Rol</th>
                  <th>ğŸ” Estado</th>
                  <th>â­ VIP</th>
                  <th style="width:260px">ğŸ› ï¸ Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let u of pageItems; trackBy: trackUser">
                  <td>
                    <span class="user-photo-small">
                      <img *ngIf="u.fotoUrl; else aliasFallback" [src]="u.fotoUrl" alt="avatar" (error)="u.fotoUrl=null" />
                      <ng-template #aliasFallback>
                        <span class="user-photo-fallback">{{ (u.alias || 'U')[0] | uppercase }}</span>
                      </ng-template>
                    </span>
                    {{ u.alias }}
                  </td>
                  <td>{{ u.nombre }}</td>
                  <td>{{ u.email }}</td>
                  <td>{{ u.role }}</td>
                  <td>
                    <span
                      class="status-badge"
                      [class.status-badge--green]="!u.blocked"
                      [class.status-badge--red]="u.blocked"
                      [title]="u.blocked ? 'Bloqueado' : 'Activo'"
                    >
                      {{ u.blocked ? 'ğŸ”’' : 'ğŸ”“' }}
                    </span>
                  </td>
                  <td class="vip-cell">
                    <ng-container *ngIf="isUser(u); else noVipCell">
                      <span
                        class="status-badge"
                        [class.status-badge--green]="!!u.vip"
                        [class.status-badge--red]="!u.vip"
                        [title]="u.vip ? 'VIP' : 'No VIP'"
                      >
                        {{ u.vip ? 'â­' : 'â˜†' }}
                      </span>
                    </ng-container>
                    <ng-template #noVipCell>â€”</ng-template>
                  </td>
                  <td class="actions-cell">
                    <button
                      type="button"
                      class="action-btn btn-edit"
                      [disabled]="!(isCreator(u) || isAdmin(u)) || isSuperAdmin(u)"
                      (click)="editUser(u)"
                      title="Editar"
                    >âœï¸</button>

                    <button
                      type="button"
                      class="action-btn btn-block"
                      [disabled]="!(isCreator(u) || isAdmin(u)) || isSuperAdmin(u)"
                      (click)="toggleBlockUser(u)"
                      [title]="u.blocked ? 'Desbloquear' : 'Bloquear'"
                    >
                      {{ u.blocked ? 'ğŸ”“' : 'ğŸ”’' }}
                    </button>

                    <button
                      type="button"
                      class="action-btn btn-consult"
                      [disabled]="!(isCreator(u) || isAdmin(u)) || isSuperAdmin(u)"
                      (click)="deleteUser(u)"
                      title="Eliminar"
                    >ğŸ—‘ï¸</button>
                  </td>
                </tr>
              </tbody>
            </table>

            <div class="pager">
              <button type="button" (click)="goto(page-1)" [disabled]="page<=1">Â«</button>
              <span>ğŸ“„ PÃ¡gina {{ page }} / {{ totalPages }}</span>
              <button type="button" (click)="goto(page+1)" [disabled]="page>=totalPages">Â»</button>
              <select [(ngModel)]="pageSize" (change)="goto(1)">
                <option [ngValue]="5">5</option>
                <option [ngValue]="10">10</option>
                <option [ngValue]="20">20</option>
                <option [ngValue]="50">50</option>
              </select>
            </div>
          </div>
        </section>

        <!-- Resto de modales sin cambios funcionales -->
        <!-- ... -->
      </main>
    </div>

  </div>
</div>
